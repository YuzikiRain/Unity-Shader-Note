## 基于深度的颜色混合

ComputeScreenPos得到片元的屏幕坐标



`tex2Dproj`（而不是tex2D）采样`_CameraDepthTexture`得到非线性深度值

`LinearEyeDepth`转换成线性深度

``` glsl
// vertex shader
float4 screenPosition = ComputeScreenPos(positionCS);  // 范围为[0,w]
tex2Dproj(_CameraDepthTexture, screenPosition);  // tex2Dproj会先将uv先除以w再进行采样，即使用范围为[0,1]的uv进行采样
```

ComputeScreenPos得到片元的屏幕坐标，

UNITY_PROJ_COORD(屏幕坐标)变换到0~1（作为uv），

tex2Dproj采样_CameraDepthTexture得到非线性深度值，

（水面的原始深度值就是ComputeScreenPos这个函数返回的w。在进行透视除法之前，原始深度值一直保存在vertex的w分量）
LinearEyeDepth转换成线性深度，与水平面深度得到差值，作为颜色的插值项

## 水面泡沫

噪声纹理+阈值截取确定泡沫区域，smoothstep优化

采样噪声纹理的uv进行简单根据时间的叠加，并再采样一张扰动纹理用于uv

## 优化：水面物体交界处泡沫不明显

片元使用观察空间法线（类似深度纹理一样直接取得或用着色器替换来额外渲染一张法线纹理），水面使用水面的观察空间法线，点乘计算方向重合程度，用于泡沫的显示。

## 优化：颜色混合只作用于泡沫而没有作用于其他区域



## 水面

为了模拟水面的起伏，可以使用法线贴图或FFT变换顶点，同样进行基本的反射计算

## 参考

- [Unity Toon Water Shader Tutorial (roystan.net)](https://roystan.net/articles/toon-water/)